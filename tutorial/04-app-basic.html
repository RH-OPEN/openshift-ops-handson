<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenShift Ops Handson</title>
    <link rel="canonical" href="https://rh-open.github.io/openshift-ops-handson/tutorial/04-app-basic.html">
    <link rel="prev" href="03-installation.html">
    <link rel="next" href="05-storage-basic.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://rh-open.github.io/openshift-ops-handson">OpenShift Ops Handson</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-env-overview.html">2. Environment Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-installation.html">3. Installation and Verification</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="04-app-basic.html">4. Application Management Basics</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-storage-basic.html">5. Application Storage Basics</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06-machineset.html">6. MachineSets, Machines, and Nodes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-operator.html">7. Infrastructure Nodes and Operators</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-logging.html">8. OpenShift Log Aggregation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-auth.html">9. External (LDAP) Authentication Providers, Users, and Groups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="10-monitoring.html">10. OpenShift Monitoring with Prometheus</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#11-project.adoc">11. Project Template, Quota, and Limits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="12-network.html">12. OpenShift Networking and NetworkPolicy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="13-clusterrolebinding.html">13. Disabling Project Self-Provisioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="14-clusterresourcequota.html">14. Cluster Resource Quotas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="15-taint.html">15. Taints and Tolerations</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Ops Tutorial</a></li>
    <li><a href="04-app-basic.html">4. Application Management Basics</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/RH-OPEN/openshift-ops-handson/edit/master/documentation/modules/ROOT/pages/04-app-basic.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_application_management_basics"><a class="anchor" href="#_application_management_basics"></a>Application Management Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このモジュールでは、 <code>oc</code> ツールを使用してサンプルアプリケーションをデプロイし、OpenShift Container Platform でのアプリケーション管理のコアコンセプト、基本オブジェクト、および基本について学びます。</p>
</div>
<div class="sect2">
<h3 id="_core_openshift_concepts"><a class="anchor" href="#_core_openshift_concepts"></a>Core OpenShift Concepts</h3>
<div class="paragraph">
<p>OpenShift の将来の管理者として、アプリケーションに関連するいくつかのコア ビルディング ブロックを理解することが重要です。 これらの構成要素を理解すると、プラットフォームでのアプリケーション管理の全体像をよりよく理解するのに役立ちます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_projects"><a class="anchor" href="#_projects"></a>Projects</h3>
<div class="paragraph">
<p><strong>プロジェクト</strong> は一種の「バケツ」です。 これは、ユーザーのすべてのリソースが存在するメタ コンストラクトです。 管理の観点からは、各 <strong>プロジェクト</strong> はテナントのように考えることができます。 <strong>プロジェクト</strong> には、それらにアクセスできる複数のユーザーがいる場合があり、ユーザーは複数の <strong>プロジェクト</strong> にアクセスできる場合があります。 技術的に言えば、ユーザーがリソースを所有するのではなく、<strong>プロジェクト</strong> が所有します。 ユーザーを削除しても、作成されたリソースには影響しません。</p>
</div>
<div class="paragraph">
<p>この演習では、まずいくつかのリソースを保持する <strong>Project</strong> を作成します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project app-management</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_a_sample_application"><a class="anchor" href="#_deploy_a_sample_application"></a>Deploy a Sample Application</h3>
<div class="paragraph">
<p><code>new-app</code> コマンドは、OpenShift に実行を指示する非常に簡単な方法を提供します。 さまざまな入力の 1 つを提供するだけで、何をすべきかを判断します。 ユーザーは通常、このコマンドを使用して、OpenShift に既存のイメージを起動させたり、ソース コードのビルドを作成して最終的にそれらをデプロイしたり、テンプレートをインスタンス化したりします。</p>
</div>
<div class="paragraph">
<p>Quay に存在する特定のイメージを起動します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-app quay.io/openshiftroadshow/mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--&gt; Found container image 7ce7ade (3 years old) from quay.io for "quay.io/openshiftroadshow/mapit"

    * An image stream tag will be created as "mapit:latest" that will track this image

--&gt; Creating resources ...
    imagestream.image.openshift.io "mapit" created
    deployment.apps "mapit" created
    service "mapit" created
--&gt; Success
    Application is not exposed. You can expose services to the outside world by executin
g one or more of the commands below:
     'oc expose service/mapit'
    Run 'oc status' to view your app.</pre>
</div>
</div>
<div class="paragraph">
<p>このコマンドの出力として、OpenShift がいくつかのリソースを自動的に作成したことがわかります。 作成されたリソースを調べるのに少し時間がかかります。</p>
</div>
<div class="paragraph">
<p><code>new-app</code> の機能の詳細については、<code>oc new-app -h</code> を実行してヘルプ メッセージを参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_pods"><a class="anchor" href="#_pods"></a>Pods</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_pod.png" alt="openshift pod">
</div>
<div class="title">Figure 1. OpenShift Pods</div>
</div>
<div class="paragraph">
<p>Pod は、ホストに一緒にデプロイされる 1 つ以上のコンテナーです。 ポッドは、OpenShift で定義、デプロイ、および管理できる最小のコンピューティング ユニットです。 各ポッドには、SDN で独自の内部 IP アドレスが割り当てられ、ポート範囲全体を所有します。 Pod 内のコンテナは、ローカル ストレージ スペースとネットワーク リソースを共有できます。</p>
</div>
<div class="paragraph">
<p>Pod は、OpenShift によって <strong>static</strong> オブジェクトとして扱われます。つまり、実行中に Pod 定義を変更することはできません。</p>
</div>
<div class="paragraph">
<p>Pod のリストを取得できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして、次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
mapit-764c5bf8b8-l49z7   1/1     Running   0          2m53s</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pod 名はデプロイ プロセスの一部として動的に生成されますが、これについては後ほど説明します。 あなたの名前は少し異なります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>describe</code> コマンドは、ポッドの詳細に関する詳細情報を提供します。 上記のポッド名の場合:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe pod -l deployment=mapit</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>-l deployment=mapit</code> は、後で説明する <code>Deployment</code> に関連するポッドを選択します。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>次のような出力が表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:         mapit-764c5bf8b8-l49z7
Namespace:    app-management
Priority:     0
Node:         ip-10-0-128-29.us-west-2.compute.internal/10.0.128.29
Start Time:   Tue, 10 Nov 2020 21:01:09 +0000
Labels:       deployment=mapit
              pod-template-hash=764c5bf8b8
Annotations:  k8s.v1.cni.cncf.io/network-status:
                [{
                    "name": "",
                    "interface": "eth0",
                    "ips": [
                        "10.129.2.99"
                    ],
                    "default": true,
                    "dns": {}
                }]
              k8s.v1.cni.cncf.io/networks-status:
                [{
                    "name": "",
                    "interface": "eth0",
                    "ips": [
                        "10.129.2.99"
                    ],
                    "default": true,
                    "dns": {}
                }]
              openshift.io/generated-by: OpenShiftNewApp
              openshift.io/scc: restricted
Status:       Running
IP:           10.129.2.99
IPs:
  IP:           10.129.2.99
Controlled By:  ReplicaSet/mapit-764c5bf8b8
Containers:
  mapit:
    Container ID:   cri-o://fb708e659c19c6aaf8211bf7e3029f8adc8cf14959bcaefa5c7e6df17d37
feaf
    Image:          quay.io/openshiftroadshow/mapit@sha256:8c7e0349b6a016e3436416f3c54debda4594ba0
9fd34b8a0dee0c4497102590d
    Image ID:       quay.io/openshiftroadshow/mapit@sha256:8c7e0349b6a016e3436416f3c54debda4594ba0
9fd34b8a0dee0c4497102590d
    Ports:          9779/TCP, 8080/TCP, 8778/TCP
    Host Ports:     0/TCP, 0/TCP, 0/TCP
    State:          Running
      Started:      Tue, 10 Nov 2020 21:01:29 +0000
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-v7fpq (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-v7fpq:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-v7fpq
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason          Age    From               Message
  ----    ------          ----   ----               -------
  Normal  Scheduled       6m50s  default-scheduler  Successfully assigned app-management
/mapit-764c5bf8b8-l49z7 to ip-10-0-128-29.us-west-2.compute.internal
  Normal  AddedInterface  6m48s  multus             Add eth0 [10.129.2.99/23]
  Normal  Pulling         6m48s  kubelet            Pulling image "quay.io/openshiftroadshow/mapit
@sha256:8c7e0349b6a016e3436416f3c54debda4594ba09fd34b8a0dee0c4497102590d"
  Normal  Pulled          6m31s  kubelet            Successfully pulled image "quay.io/t
horaxe/mapit@sha256:8c7e0349b6a016e3436416f3c54debda4594ba09fd34b8a0dee0c4497102590d" in
 16.762028989s
  Normal  Created         6m31s  kubelet            Created container mapit
  Normal  Started         6m31s  kubelet            Started container mapit</pre>
</div>
</div>
<div class="paragraph">
<p>これは、実行中のポッドの詳細な説明です。 ポッドが実行されているノード、ポッドの内部 IP アドレス、さまざまなラベル、および何が起こっているかに関するその他の情報を確認できます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_services"><a class="anchor" href="#_services"></a>Services</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_service.png" alt="openshift service">
</div>
<div class="title">Figure 2. OpenShift Service</div>
</div>
<div class="paragraph">
<p><strong>Service</strong> は、OpenShift 内で <strong>Pod</strong> のようなグループを見つけるための便利な抽象化レイヤーを提供します。 また、これらの <strong>Pod</strong> と、OpenShift 環境内からそれらにアクセスする必要があるその他のものとの間の内部プロキシ/ロード バランサーとしても機能します。 たとえば、負荷を処理するためにより多くの <code>mapit</code> インスタンスが必要な場合は、より多くの <strong>Pod</strong> を起動できます。 OpenShift はそれらをエンドポイントとして <strong>Service</strong> に自動的にマップし、着信要求は、<strong>Service</strong> が要求をより適切に処理するようになったことを除いて、何も違いを認識しません。</p>
</div>
<div class="paragraph">
<p>OpenShift にイメージの実行を依頼すると、<code>new-app</code> コマンドによって <strong>Service</strong> が自動的に作成されました。 サービスは内部構造であることを忘れないでください。 それらは「外の世界」、または OpenShift 環境の外にあるものには使用できません。 後で学習するので、それで問題ありません。</p>
</div>
<div class="paragraph">
<p><strong>Service</strong> が <strong>Pod</strong> のセットにマップされる方法は、<strong>Labels</strong> と <strong>Selector</strong> のシステムを介して行われます。 *サービス*には固定 IP アドレスが割り当てられ、多くのポートとプロトコルをマッピングできます。</p>
</div>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/4.9/architecture/understanding-development.html#understanding-kubernetes-pods">Services</a> については、手動で作成するための YAML 形式など、さらに多くの情報があります。 公式ドキュメントで。</p>
</div>
<div class="paragraph">
<p>プロジェクト内のサービスの現在のリストは、次の方法で表示できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get services</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
mapit   ClusterIP   172.30.167.160   &lt;none&gt;        8080/TCP,8778/TCP,9779/TCP   26</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
サービス IP アドレスは作成時に動的に割り当てられ、不変です。 サービスの IP は変更されず、IP はサービスが削除されるまで予約されます。 サービス IP は異なる可能性があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ポッドと同様に、サービスも <code>describe</code> できます。 実際、OpenShift ではほとんどのオブジェクトを <code>describe</code> できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe service mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:              mapit
Namespace:         app-management
Labels:            app=mapit
                   app.kubernetes.io/component=mapit
                   app.kubernetes.io/instance=mapit
Annotations:       openshift.io/generated-by: OpenShiftNewApp
Selector:          deployment=mapit
Type:              ClusterIP
IP:                172.30.167.160
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.129.2.99:8080
Port:              8778-tcp  8778/TCP
TargetPort:        8778/TCP
Endpoints:         10.129.2.99:8778
Port:              9779-tcp  9779/TCP
TargetPort:        9779/TCP
Endpoints:         10.129.2.99:9779
Session Affinity:  None
Events:            &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>すべてのオブジェクトに関する情報 (定義、状態など) は、etcd データストアに保存されます。 etcd はデータをキーと値のペアとして保存し、このデータはすべてシリアライズ可能なデータ オブジェクト (JSON、YAML) として表すことができます。</p>
</div>
<div class="paragraph">
<p>サービスの YAML 出力を見てください。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get service mapit -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Service
metadata:
  annotations:
    openshift.io/generated-by: OpenShiftNewApp
  creationTimestamp: "2020-11-10T21:01:09Z"
  labels:
    app: mapit
    app.kubernetes.io/component: mapit
    app.kubernetes.io/instance: mapit
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:openshift.io/generated-by: {}
        f:labels:
          .: {}
          f:app: {}
          f:app.kubernetes.io/component: {}
          f:app.kubernetes.io/instance: {}
      f:spec:
        f:ports:
          .: {}
          k:{"port":8080,"protocol":"TCP"}:
            .: {}
            f:name: {}
            f:port: {}
            f:protocol: {}
            f:targetPort: {}
          k:{"port":8778,"protocol":"TCP"}:
            .: {}
            f:name: {}
            f:port: {}
            f:protocol: {}
            f:targetPort: {}
          k:{"port":9779,"protocol":"TCP"}:
            .: {}
            f:name: {}
            f:port: {}
            f:protocol: {}
            f:targetPort: {}
        f:selector:
          .: {}
          f:deployment: {}
        f:sessionAffinity: {}
        f:type: {}
    manager: oc
    operation: Update
    time: "2020-11-10T21:01:09Z"
  name: mapit
  namespace: app-management
  resourceVersion: "106194"
  selfLink: /api/v1/namespaces/app-management/services/mapit
  uid: 921c2e2c-a53e-4f83-8e76-9df962069314
spec:
  clusterIP: 172.30.167.160
  ports:
  - name: 8080-tcp
    port: 8080
    protocol: TCP
    targetPort: 8080
  - name: 8778-tcp
    port: 8778
    protocol: TCP
    targetPort: 8778
  - name: 9779-tcp
    port: 9779
    protocol: TCP
    targetPort: 9779
  selector:
    deployment: mapit
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}</pre>
</div>
</div>
<div class="paragraph">
<p><code>selector</code> スタンザに注意してください。 それを覚えて。</p>
</div>
<div class="paragraph">
<p>また、<strong>Pod</strong> の YAML を表示して、OpenShift がコンポーネントをどのように結び付けているかを理解することも重要です。 戻って <code>mapit</code> <strong>Pod</strong> の名前を見つけ、次を実行します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pod -l deployment=mapit -o jsonpath='{.items[*].metadata.labels}' | jq -r</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>-o jsonpath</code> は特定のフィールドを選択します。 この場合、マニフェストの <code>labels</code> セクションを求めています。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>出力は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "deployment": "mapit",
  "pod-template-hash": "764c5bf8b8"
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Service</strong> には、<code>deployment: mapit</code> を参照する <code>selector</code> スタンザがあります。</p>
</li>
<li>
<p><strong>ポッド</strong> には複数の <strong>ラベル</strong> があります。</p>
<div class="ulist">
<ul>
<li>
<p><code>deployment: mapit</code></p>
</li>
<li>
<p><code>pod-template-hash: 764c5bf8b8</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ラベル</strong> は単なるキーと値のペアです。 <strong>Selector</strong> と一致する <strong>Label</strong> を持つこの <strong>Project</strong> 内の <strong>Pod</strong> は、<strong>Service</strong> に関連付けられます。 <code>describe</code> の出力をもう一度見ると、サービスのエンドポイントが 1 つあることがわかります。既存の <code>mapit</code> <strong>Pod</strong> です。</p>
</div>
<div class="paragraph">
<p><code>new-app</code> のデフォルトの動作は、要求された項目のインスタンスを 1 つだけ作成することです。 これを変更/調整する方法についてはすぐに説明しますが、最初に学ぶべき概念がいくつかあります。</p>
</div>
</div>
<div class="sect2">
<h3 id="_background_deployment_configurations_and_replica_sets"><a class="anchor" href="#_background_deployment_configurations_and_replica_sets"></a>Background: Deployment Configurations and Replica Sets</h3>
<div class="paragraph">
<p><strong>Service</strong> は <strong>Pod</strong> のルーティングとロード バランシングを提供しますが、これらは存在したり消えたりする可能性がありますが、<strong>ReplicaSets</strong> (RS) を使用して指定し、必要な数の <strong>Pod</strong> (レプリカ) が存在するようにします。 たとえば、アプリケーションを常に 3 つの <strong>Pod</strong> (インスタンス) にスケーリングする場合は、<strong>ReplicaSet</strong> が必要です。 RS がないと、強制終了された <strong>Pod</strong> または何らかの理由で終了/終了した <strong>Pod</strong> は、自動的に再起動されません。 <strong>ReplicaSets</strong> は、OpenShift が「自己修復」する方法です。</p>
</div>
<div class="paragraph">
<p><strong>Deployment</strong> (デプロイ) は、OpenShift で何かをデプロイする方法を定義します。 <a href="https://docs.openshift.com/container-platform/4.9/applications/deployments/what-deployments-are.html#deployments-kube-deployments_what-deployments-are">deployments documentation</a> から:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deployments describe the desired state of a particular component of an
application as a Pod template. Deployments create ReplicaSets, which
orchestrate Pod lifecycles.</pre>
</div>
</div>
<div class="paragraph">
<p>ほとんどの場合、<strong>Pod</strong>、<strong>Service</strong>、<strong>ReplicaSet</strong>、<strong>Deployment</strong> リソースを一緒に使用することになります。 そして、それらのほとんどすべてのケースで、OpenShift がそれらすべてを作成します。</p>
</div>
<div class="paragraph">
<p><strong>Deployments</strong> や <strong>Service</strong> を使用せずに <strong>Pod</strong> や <strong>RS</strong> が必要になるエッジ ケースもいくつかありますが、これらは高度なトピックであり、これらの演習ではカバーされていません。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
OpenShift の以前のバージョンでは、<strong>DeploymentConfig</strong> と呼ばれるものを使用していました。 依然として有効な展開メカニズムですが、先に進む <strong>Deployment</strong> は <code>oc new-app</code> で作成されるものになります。 詳細については、 <a href="https://docs.openshift.com/container-platform/4.9/applications/deployments/what-deployments-are.html#deployments-comparing-deploymentconfigs_what-deployments-are">official documentation</a> を参照してください。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exploring_deployment_related_objects"><a class="anchor" href="#_exploring_deployment_related_objects"></a>Exploring Deployment-related Objects</h3>
<div class="paragraph">
<p><strong>ReplicaSet</strong> と <strong>Deployment</strong> が何であるかの背景がわかったので、それらがどのように機能し、どのように関連しているかを調べることができます。 OpenShift に <code>mapit</code> イメージを立ち上げるように指示したときに作成された <strong>Deployment</strong> (デプロイ) を見てください。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
mapit   1/1     1            1           76m</pre>
</div>
</div>
<div class="paragraph">
<p>詳細については、<strong>ReplicaSet</strong> (<strong>RS</strong>) を参照してください。</p>
</div>
<div class="paragraph">
<p>OpenShift に <code>mapit</code> イメージを立ち上げるように指示したときに作成された <strong>ReplicaSet</strong> (RS) を見てください。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get rs</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
mapit-7bf4f447ff   0         0         0       18m
mapit-85fdb44576   1         1         1       18m</pre>
</div>
</div>
<div class="paragraph">
<p>これにより、現時点では 1 つの <strong>Pod</strong> がデプロイされると予想され (<code>Desired</code>)、1 つの <strong>Pod</strong> が実際にデプロイされている (<code>Current</code>) ことがわかります。 必要な数を変更することで、必要な <strong>Pod</strong> の数を OpenShift に伝えることができます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_the_application"><a class="anchor" href="#_scaling_the_application"></a>Scaling the Application</h3>
<div class="paragraph">
<p>mapit の「アプリケーション」を 2 つのインスタンスにスケーリングしてみましょう。 これは <code>scale</code> コマンドで行うことができます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc scale --replicas=2 deploy/mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>レプリカの数を変更したことを確認するには、次のコマンドを発行します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get rs</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
mapit-764c5bf8b8   2         2         2       79m
mapit-8695cb9c67   0         0         0       79m</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
「古い」バージョンが保持されました。 これは、以前のバージョンのアプリケーションに「ロールバック」できるようにするためです。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>レプリカが 2 つあることがわかります。  <code>oc get pods</code> コマンドでポッドの数を確認しましょう。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
mapit-764c5bf8b8-b4vpn   1/1     Running   0          112s
mapit-764c5bf8b8-l49z7   1/1     Running   0          81m</pre>
</div>
</div>
<div class="paragraph">
<p>最後に、前のラボで学習した <strong>Service</strong> が 2 つのエンドポイントを正確に反映していることを確認しましょう。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe svc mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name:              mapit
Namespace:         app-management
Labels:            app=mapit
                   app.kubernetes.io/component=mapit
                   app.kubernetes.io/instance=mapit
Annotations:       openshift.io/generated-by: OpenShiftNewApp
Selector:          deployment=mapit
Type:              ClusterIP
IP:                172.30.167.160
Port:              8080-tcp  8080/TCP
TargetPort:        8080/TCP
Endpoints:         10.128.2.19:8080,10.129.2.99:8080
Port:              8778-tcp  8778/TCP
TargetPort:        8778/TCP
Endpoints:         10.128.2.19:8778,10.129.2.99:8778
Port:              9779-tcp  9779/TCP
TargetPort:        9779/TCP
Endpoints:         10.128.2.19:9779,10.129.2.99:9779
Session Affinity:  None
Events:            &lt;none&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Service</strong> のエンドポイントを確認する別の方法は、次のとおりです。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get endpoints mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    ENDPOINTS                                                        AGE
mapit   10.128.2.19:8080,10.129.2.99:8080,10.128.2.19:9779 + 3 more...   81m</pre>
</div>
</div>
<div class="paragraph">
<p>各ポッドは OpenShift 環境内で一意の IP を受け取るため、IP アドレスは異なる可能性があります。 エンドポイント リストは、サービスの背後にあるポッドの数をすばやく確認する方法です。</p>
</div>
<div class="paragraph">
<p>全体として、これはアプリケーション (<strong>Service</strong> 内の <strong>Pod</strong>) のスケーリングがいかに簡単かということです。 OpenShift は既存のイメージの新しいインスタンスを起動するだけであるため、特にそのイメージがノードに既にキャッシュされている場合は、アプリケーションのスケーリングが非常に迅速に行われる可能性があります。</p>
</div>
<div class="paragraph">
<p>最後に注意すべきことは、実際にはこの <strong>サービス</strong> でいくつかのポートが定義されていることです。 先ほど、ポッドは単一の IP を取得し、その IP 上のポート空間全体を制御できると述べました。 <strong>Pod</strong> 内で実行されている何かが複数のポート (複数のポートを使用する単一のコンテナー、個々のポートを使用する個々のコンテナー、混合) でリッスンする場合がありますが、<strong>Service</strong> は実際にポートをさまざまな場所にプロキシ/マップできます。</p>
</div>
<div class="paragraph">
<p>たとえば、<strong>Service</strong> はポート 80 でリッスンできますが (従来の理由により)、<strong>Pod</strong> はポート 8080、8888、またはその他のポートでリッスンできます。</p>
</div>
<div class="paragraph">
<p>この <code>mapit</code> のケースでは、実行したイメージの <code>Dockerfile</code> に複数の <code>EXPOSE</code> ステートメントが含まれているため、OpenShift はサービスにポートを自動的に作成し、それらを <strong>Pod</strong> にマップしました。</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_self_healing"><a class="anchor" href="#_application_self_healing"></a>Application "Self Healing"</h3>
<div class="paragraph">
<p>OpenShift の <strong>RS</strong> は、必要な数の <strong>Pod</strong> が実際に実行されていることを確認するために常に監視しているため、状況が正しくない場合、OpenShift が状況を「修正」することも期待できます。 あなたは正しいでしょう！</p>
</div>
<div class="paragraph">
<p>現在 2 つの <strong>Pod</strong> が実行されているので、それらを削除するとどうなるか見てみましょう。 最初に、 <code>oc get pods</code> コマンドを実行し、<strong>Pod</strong> 名をメモします。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなものが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                     READY   STATUS    RESTARTS   AGE
mapit-764c5bf8b8-lxnvw   1/1     Running   0          2m28s
mapit-764c5bf8b8-rscss   1/1     Running   0          2m54s</pre>
</div>
</div>
<div class="paragraph">
<p>ここで、<strong>Deployment</strong> <code>mapit</code> に属するポッドを削除します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete pods -l deployment=mapit --wait=false</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>oc get pods</code> コマンドをもう一度実行します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>何か気づきましたか？ すでに実行中の新しいコンテナがあります。</p>
</div>
<div class="paragraph">
<p><strong>Pods</strong> には別の名前があります。 これは、OpenShift が現在の状態 (削除されたため 0 個の <strong>Pod</strong>) が目的の状態 (2 個の <strong>Pod</strong>) と一致しないことをすぐに検出し、<strong>Pod</strong> をスケジュールすることで修正したためです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_background_routes"><a class="anchor" href="#_background_routes"></a>Background: Routes</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="images/openshift_route.png" alt="openshift route">
</div>
<div class="title">Figure 3. OpenShift Route</div>
</div>
<div class="paragraph">
<p><strong>サービス</strong> は OpenShift 環境内で内部抽象化と負荷分散を提供しますが、OpenShift の<strong>外部</strong>のクライアント (ユーザー、システム、デバイスなど) がアプリケーションにアクセスする必要がある場合があります。 外部クライアントが OpenShift で実行されているアプリケーションにアクセスできる方法は、OpenShift ルーティング レイヤーを経由することです。 その背後にあるデータ オブジェクトは <strong>Route</strong> です。</p>
</div>
<div class="paragraph">
<p>デフォルトの OpenShift ルーター (HAProxy) は、着信要求の HTTP ヘッダーを使用して、接続をプロキシする場所を決定します。 オプションで、<strong>Route</strong> に対して TLS などのセキュリティを定義できます。 <strong>Service</strong> (ひいては <strong>Pod</strong>) を外の世界からアクセスできるようにしたい場合は、<strong>Route</strong> を作成する必要があります。</p>
</div>
<div class="paragraph">
<p>ルーターの設定を覚えていますか？ あなたはおそらくしません。 これは、インストールによってルーター用のオペレーターがデプロイされ、オペレーターがルーターを作成したためです! ルーターは <code>openshift-ingress</code> <strong>Project</strong> に存在し、次のコマンドでそれに関する情報を確認できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe deployment router-default -n openshift-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>以降の演習では、ルーターの Operator について詳しく説明します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_route"><a class="anchor" href="#_creating_a_route"></a>Creating a Route</h3>
<div class="paragraph">
<p><strong>ルート</strong> の作成は非常に簡単なプロセスです。 コマンドラインから <strong>Service</strong> を <code>expose</code> するだけです。 以前のことを覚えているなら、あなたの <strong>Service</strong> 名は <code>mapit</code> です。 <strong>Service</strong> という名前を使用すると、<strong>Route</strong> を作成するのは簡単な 1 つのコマンド タスクです。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc expose service mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下が表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>route.route.openshift.io/mapit exposed</pre>
</div>
</div>
<div class="paragraph">
<p>次のコマンドで <strong>Route</strong> が作成されたことを確認します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    HOST/PORT                                             PATH   SERVICES   PORT       TERMINATION   WILDCARD
mapit   mapit-app-management.{{ ROUTE_SUBDOMAIN }}                   mapit      8080-tcp                 None</pre>
</div>
</div>
<div class="paragraph">
<p><code>HOST/PORT</code> 列を見ると、おなじみの FQDN が表示されます。 OpenShift のデフォルトの動作は、公式のホスト名でサービスを公開することです。</p>
</div>
<div class="paragraph">
<p><code>{SERVICENAME}-{PROJECTNAME}.{ROUTINGSUBDOMAIN}</code></p>
</div>
<div class="paragraph">
<p>以降のルーター オペレーター ラボでは、この設定オプションとその他の設定オプションについて説明します。</p>
</div>
<div class="paragraph">
<p>ルーター構成では、ルーターがリッスンする必要があるドメインを指定しますが、最初にそれらのドメインの要求をルーターに取得する必要があります。 <code>*.apps...</code> をルーターが存在するホストに向けるワイルドカード DNS エントリーがあります。 OpenShift は、<strong>Service</strong> 名、<strong>Project</strong> 名、およびルーティング サブドメインを連結して、この FQDN/URL を作成します。</p>
</div>
<div class="paragraph">
<p>ブラウザ、curl、またはその他のツールを使用して、この URL にアクセスできます。 インターネット上のどこからでもアクセスできる必要があります。</p>
</div>
<div class="paragraph">
<p><strong>Route</strong> は <strong>Service</strong> に関連付けられており、ルーターは自動的に接続を <strong>Pod</strong> に直接プロキシします。 ルーター自体は <strong>Pod</strong> として動作します。 「実際の」インターネットを SDN に橋渡しします。</p>
</div>
<div class="paragraph">
<p>これまでに行ったすべてのことを振り返ってみると、次の 3 つのコマンドで、アプリケーションをデプロイし、スケーリングし、外部からアクセスできるようにしました。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-app quay.io/openshiftroadshow/mapit
oc scale --replicas=2 deploy/mapit
oc expose service mapit</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scale_down"><a class="anchor" href="#_scale_down"></a>Scale Down</h3>
<div class="paragraph">
<p>続行する前に、アプリケーションを 1 つのインスタンスにスケールダウンします。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc scale --replicas=1 deploy/mapit</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_probes"><a class="anchor" href="#_application_probes"></a>Application Probes</h3>
<div class="paragraph">
<p>OpenShift は、アプリケーション インスタンスの活性や準備状況のチェックに関する基本的な機能を提供します。 基本的なチェックが不十分な場合、OpenShift では、チェックを実行するために <strong>Pod</strong>/コンテナー内でコマンドを実行することもできます。 そのコマンドは、コンテナー イメージ内に既にインストールされている任意の言語を使用する複雑なスクリプトになる可能性があります。</p>
</div>
<div class="paragraph">
<p>定義できるアプリケーション プローブには、次の 2 種類があります。</p>
</div>
<div class="paragraph">
<p><strong>Liveness Probe</strong></p>
</div>
<div class="paragraph">
<p>liveness プローブは、それが構成されているコンテナーがまだ実行されているかどうかを確認します。 liveness プローブが失敗した場合、コンテナは強制終了され、再起動ポリシーが適用されます。</p>
</div>
<div class="paragraph">
<p><strong>Readiness Probe</strong></p>
</div>
<div class="paragraph">
<p>readiness プローブは、コンテナーが要求を処理する準備ができているかどうかを判断します。 準備プローブが失敗した場合、エンドポイントのコントローラーは、コンテナーの IP アドレスが、一致する必要があるすべてのサービスのエンドポイントから削除されていることを確認します。 readiness プローブを使用して、コンテナーが実行されていても、トラフィックを受信してはならないことをエンドポイントのコントローラーに通知できます。</p>
</div>
<div class="paragraph">
<p>アプリケーションのプローブに関する詳細は、ドキュメントの <a href="https://docs.openshift.com/container-platform/4.9/applications/application-health.html">Application Health</a> セクションを参照してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_probes_to_the_application"><a class="anchor" href="#_add_probes_to_the_application"></a>Add Probes to the Application</h3>
<div class="paragraph">
<p><code>oc set</code> コマンドは、いくつかの異なる機能を実行するために使用できます。そのうちの 1 つは、プローブの作成および/または変更です。  <code>mapit</code> アプリケーションはエンドポイントを公開します。エンドポイントが有効で、応答する準備ができているかどうかを確認できます。 <code>curl</code> を使用してテストできます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl mapit-app-management.{{ ROUTE_SUBDOMAIN }}/health</code></pre>
</div>
</div>
<div class="paragraph">
<p>応答として JSON を取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"status":"UP","diskSpace":{"status":"UP","total":10724835328,"free":10257825792,"threshold":10485760}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のコマンドを使用して、OpenShift にこのエンドポイントの活性をプローブするように依頼できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc set probe deploy/mapit --liveness --get-url=http://:8080/health --initial-delay-seconds=30</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、このプローブが <code>oc describe</code> 出力で定義されていることがわかります。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc describe deploy mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のようなセクションが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
  Containers:
   mapit:
    Image:        quay.io/openshiftroadshow/mapit@sha256:8c7e0349b6a016e3436416f3c54debda
4594ba09fd34b8a0dee0c4497102590d
    Ports:        9779/TCP, 8080/TCP, 8778/TCP
    Host Ports:   0/TCP, 0/TCP, 0/TCP
    Liveness:     http-get http://:8080/health delay=30s timeout=1s period=10s
#success=1 #failure=3
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
...</pre>
</div>
</div>
<div class="paragraph">
<p>同様に、readiness プローブを同じ方法で設定できます。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc set probe deploy/mapit --readiness --get-url=http://:8080/health --initial-delay-seconds=30</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examining_deployments_and_replicasets"><a class="anchor" href="#_examining_deployments_and_replicasets"></a>Examining Deployments and ReplicaSets</h3>
<div class="paragraph">
<p><strong>Deployment</strong> への各変更は、<em>configuration</em> 変更としてカウントされ、新しい <em>deployment</em> を <em>トリガー</em> します。 <strong>Deployment</strong> は、どの <strong>ReplicaSet</strong> をデプロイするかを担当します。 <em>newest</em> が常にデプロイされます。</p>
</div>
<div class="paragraph">
<p>以下を実行します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のように表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
mapit   1/1     1            1           131m</pre>
</div>
</div>
<div class="paragraph">
<p>最初の展開後に 2 つの重要な構成変更 (およびスケール) を行ったので、<strong>展開</strong> の 4 回目の改訂に進みました。</p>
</div>
<div class="paragraph">
<p>以下を実行します。</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get replicasets</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のように表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME               DESIRED   CURRENT   READY   AGE
mapit-5f695ff4b8   1         1         1       4m19s
mapit-668f69cdd5   0         0         0       6m18s
mapit-764c5bf8b8   0         0         0       133m
mapit-8695cb9c67   0         0         0       133m</pre>
</div>
</div>
<div class="paragraph">
<p>新しいデプロイがトリガーされるたびに、デプロイヤ ポッドは新しい <strong>ReplicaSet</strong> を作成します。これは、ポッドが存在することを保証します。 古い RS の目的のスケールは 0 であり、最新の RS の目的のスケールは 1 であることに注意してください。</p>
</div>
<div class="paragraph">
<p>これらの各 RS を <code>oc describe</code> すると、以前のバージョンにはプローブがなく、最新の実行中の RS には新しいプローブがあることがわかります。</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-installation.html">3. Installation and Verification</a></span>
  <span class="next"><a href="05-storage-basic.html">5. Application Storage Basics</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
